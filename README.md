/*

**ะขะตัะฝะธัะตัะบะธะต ัะตัะตะฝะธั:**
x-message-ttl ะธ dead letter queues ะดะปั ะพัะปะพะถะตะฝะฝะพะน ะพัะฟัะฐะฒะบะธ
- **Graceful shutdown** ะดะปั ะฒัะตั ะบะพะผะฟะพะฝะตะฝัะพะฒ (context, sync.WaitGroup)
- **Structured logging** (zerolog/zap) ั correlation IDs
- **ะะตััะธะบะธ Prometheus** โ ะฟะพะบะฐะถะธ ะบะพะปะธัะตััะฒะพ ะพะฑัะฐะฑะพัะฐะฝะฝัั ัะฒะตะดะพะผะปะตะฝะธะน, latency, ะพัะธะฑะบะธ
- **Health checks** ัะฝะดะฟะพะธะฝัั ะดะปั k8s readiness/liveness

**ะะฐััะตัะฝั, ะบะพัะพััะต ะฟะพะบะฐะถัั ะพะฟัั:**
- **Strategy pattern** ะดะปั ัะฐะทะฝัั ะบะฐะฝะฐะปะพะฒ ะพัะฟัะฐะฒะบะธ (Email, Telegram, SMS)
- **Repository pattern** ั ะธะฝัะตััะตะนัะฐะผะธ (ะปะตะณะบะพ ะผะพะบะธัะพะฒะฐัั)
- **Circuit Breaker** ะดะปั ะฒะฝะตัะฝะธั ัะตัะฒะธัะพะฒ ะพัะฟัะฐะฒะบะธ
- **Outbox pattern** ะดะปั ะณะฐัะฐะฝัะธะธ ะดะพััะฐะฒะบะธ (ะพะฟัะธะพะฝะฐะปัะฝะพ, ะฝะพ wow-ัััะตะบั)

### 3. **ะญะบัะฟะพะฝะตะฝัะธะฐะปัะฝัะน retry โ ัะดะตะปะฐะน ะฟัะฐะฒะธะปัะฝะพ:**
ะะตัะฒะฐั ะฟะพะฟััะบะฐ โ ะพัะธะฑะบะฐ โ 2s ะทะฐะดะตัะถะบะฐ
ะัะพัะฐั ะฟะพะฟััะบะฐ โ ะพัะธะฑะบะฐ โ 4s ะทะฐะดะตัะถะบะฐ  
ะขัะตััั ะฟะพะฟััะบะฐ โ ะพัะธะฑะบะฐ โ 8s ะทะฐะดะตัะถะบะฐ
ะะฐะบัะธะผัะผ 5 ะฟะพะฟััะพะบ โ DLQ (dead letter queue)
ะัะฟะพะปัะทัะน x-death header ะฒ RabbitMQ ะดะปั ะฟะพะดััะตัะฐ ะฟะพะฟััะพะบ ะธะปะธ ััะฐะฝะธ ะฒ Redis.
4. Redis โ ะธัะฟะพะปัะทัะน ั ัะผะพะผ:

ะัั ััะฐัััะพะฒ ัะฒะตะดะพะผะปะตะฝะธะน (read-through cache)
Distributed lock ะดะปั ะฟัะตะดะพัะฒัะฐัะตะฝะธั ะดัะฑะปะธัะพะฒะฐะฝะธั ะพะฑัะฐะฑะพัะบะธ
Rate limiting ะดะปั API
Sorted Set ะดะปั ะฑััััะพะน ะฒัะฑะพัะบะธ ัะฒะตะดะพะผะปะตะฝะธะน ะฟะพ ะฒัะตะผะตะฝะธ

5. ะะฐะทะฐ ะดะฐะฝะฝัั:
ะัะฟะพะปัะทัะน PostgreSQL ั ะฟัะฐะฒะธะปัะฝะพะน ััะตะผะพะน:
sqlnotifications (
  id, user_id, channel, payload,
  scheduled_at, sent_at, status,
  retry_count, last_error, created_at
)
-- ะะฝะดะตะบั ะฝะฐ (status, scheduled_at) ะดะปั ัััะตะบัะธะฒะฝะพะน ะฒัะฑะพัะบะธ
๐ ะงัะพ ัะดะตะปะฐะตั ะฟัะพะตะบั ะฒัะดะฐััะธะผัั:
Must-have ะดะปั "ะฒะฐั-ัััะตะบัะฐ":

Docker Compose ัะพ ะฒัะตะผ ััะตะบะพะผ (postgres, redis, rabbitmq, app)
Makefile ั ะบะพะผะฐะฝะดะฐะผะธ: make up, make test, make migrate
Migrations (golang-migrate)
Unit ัะตััั ั ะผะพะบะฐะผะธ (testify/mock) โ ะผะธะฝะธะผัะผ 70% coverage
Integration ัะตััั ั testcontainers
OpenAPI/Swagger ะดะพะบัะผะตะฝัะฐัะธั
README ั ะฐััะธัะตะบัััะฝะพะน ะดะธะฐะณัะฐะผะผะพะน (ะผะพะถะฝะพ mermaid)

UI โ ัะดะตะปะฐะน ะผะธะฝะธะผะฐะปะธััะธัะฝะพ, ะฝะพ ััะฝะบัะธะพะฝะฐะปัะฝะพ:

Single page ะฝะฐ HTMX + TailwindCSS (ะผะพะดะฝะพ ะธ ะฑััััะพ)
WebSocket ะดะปั real-time ะพะฑะฝะพะฒะปะตะฝะธั ััะฐัััะพะฒ
Timeline ั ัะฒะตะดะพะผะปะตะฝะธัะผะธ ะธ ะธั ััะฐัััะฐะผะธ
ะคะพัะผะฐ ัะพะทะดะฐะฝะธั ั ะฒัะฑะพัะพะผ ะบะฐะฝะฐะปะฐ ะธ ะฒัะตะผะตะฝะธ

Wow-ัะธัะธ (ะฒัะฑะตัะธ 2-3):

Batch processing โ ะณััะฟะฟะธัะพะฒะบะฐ ัะฒะตะดะพะผะปะตะฝะธะน ะดะปั ะพะฟัะธะผะธะทะฐัะธะธ
Priority queues โ ัะฐะทะฝัะต ะพัะตัะตะดะธ ะดะปั ััะพัะฝัั/ะพะฑััะฝัั ัะฒะตะดะพะผะปะตะฝะธะน
Rate limiting per user โ ะทะฐัะธัะฐ ะพั ัะฟะฐะผะฐ
Webhook ะฟะพะดะดะตัะถะบะฐ โ callback ะฟะพัะปะต ะพัะฟัะฐะฒะบะธ
ะขะตะผะฟะปะตะนัั ัะฒะตะดะพะผะปะตะฝะธะน ั ะฟะตัะตะผะตะฝะฝัะผะธ
Audit log ะฒัะตั ะพะฟะตัะฐัะธะน

๐ ะะพััะดะพะบ ัะฐะทัะฐะฑะพัะบะธ:
ะะตะดะตะปั 1:

ะะฐะทะพะฒะฐั ััััะบัััะฐ ะฟัะพะตะบัะฐ
HTTP API + ะฒะฐะปะธะดะฐัะธั (go-playground/validator)
PostgreSQL repository
RabbitMQ producer

ะะตะดะตะปั 2:

Worker ั ะพะฑัะฐะฑะพัะบะพะน ะพัะตัะตะดะธ
Scheduler ะดะปั delayed messages
Redis ะธะฝัะตะณัะฐัะธั
Retry ะผะตัะฐะฝะธะทะผ

ะะตะดะตะปั 3:

ะะฐะฝะฐะปั ะพัะฟัะฐะฒะบะธ (ะผะธะฝะธะผัะผ Email + mock Telegram)
ะะตััะธะบะธ ะธ ะปะพะณะธัะพะฒะฐะฝะธะต
ะขะตััั

ะะตะดะตะปั 4:

UI
Docker compose
ะะพะบัะผะตะฝัะฐัะธั
ะะพะปะธัะพะฒะบะฐ

โ๏ธ ะงะตะณะพ ะธะทะฑะตะณะฐัั:

โ Polling ะฑะฐะทั ะบะฐะถะดัั ัะตะบัะฝะดั
โ ะฅัะฐะฝะตะฝะธะต ะฟะฐัะพะปะตะน/ัะพะบะตะฝะพะฒ ะฒ ะบะพะดะต
โ ะะณะฝะพัะธัะพะฒะฐะฝะธะต ะพัะธะฑะพะบ
โ ะะปะพะฑะฐะปัะฝัะต ะฟะตัะตะผะตะฝะฝัะต
โ ะะพะด ะฑะตะท ัะตััะพะฒ

*/



# Order Service - ะะธะบัะพัะตัะฒะธั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ | Ready To Check

[![License](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)

ะััะพะบะพะฝะฐะณััะถะตะฝะฝัะน ะผะธะบัะพัะตัะฒะธั ะดะปั ะพะฑัะฐะฑะพัะบะธ ะทะฐะบะฐะทะพะฒ ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ Kafka, PostgreSQL ะธ LRU ะบััะตะผ. ะะฐะทัะฐะฑะพัะฐะฝ ะบะฐะบ ัะตัะตะฝะธะต ัะตััะพะฒะพะณะพ ะทะฐะดะฐะฝะธั L0 ะดะปั WB ะขะตัะฝะพัะบะพะปั.

## ๐๏ธ ะััะธัะตะบัััะฐ

```
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
โ   Kafka     โ     โ PostgreSQL  โ    โ   LRU       โ
โ  Producer   โโโโ> โ   Orders    โ    โ   Cache     โ
โโโโโโโโโโโโโโโ     โโโโโโโโโโโโโโโ    โโโโโโโโโโโโโโโ
       โ                   โฒ                   โฒ
       โ                   โ                   โ
       โผ                   โ                   โ
โโโโโโโโโโโโโโโ            โ                   โ
โ   Kafka     โ            โ                   โ
โ  Consumer   โโโโโโโโโโโโโโผโโโโโโโโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโ            โ
       โ                   โ
       โผ                   โ
โโโโโโโโโโโโโโโ            โ
โ   HTTP      โ            โ
โ   API       โโโโโโโโโโโโโโ
โโโโโโโโโโโโโโโ
```

## โจ ะะปััะตะฒัะต ะพัะพะฑะตะฝะฝะพััะธ

- **ะะธะบัะพัะตัะฒะธัะฝะฐั ะฐััะธัะตะบัััะฐ** - ะงะตัะบะพะต ัะฐะทะดะตะปะตะฝะธะต ะฝะฐ ัะปะพะธ (ััะฐะฝัะฟะพัั, ะฑะธะทะฝะตั-ะปะพะณะธะบะฐ, ัะตะฟะพะทะธัะพัะธะน)
- **Kafka Integration** - ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะพะฒ ะธะท ัะพะฟะธะบะฐ Kafka
- **PostgreSQL** - ะฅัะฐะฝะตะฝะธะต ะดะฐะฝะฝัั ะพ ะทะฐะบะฐะทะฐั ะฒ ัะตะปััะธะพะฝะฝะพะน ะะ  
- **In-Memory Cache** - LRU-ะบัั ั TTL ะดะปั ััะบะพัะตะฝะธั ะดะพัััะฟะฐ ะบ ะดะฐะฝะฝัะผ
- **Dead Letter Queue (DLQ)** - ะะฑัะฐะฑะพัะบะฐ ะฝะตะบะพััะตะบัะฝัั ัะพะพะฑัะตะฝะธะน ั ะฒะพะทะผะพะถะฝะพัััั ะฟะพะฒัะพัะฝะพะน ะพะฑัะฐะฑะพัะบะธ
- **Graceful Shutdown** - ะะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ัะฐะฑะพัั ัะตัะฒะธัะฐ
- **Structured Logging** - ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ั ะธัะฟะพะปัะทะพะฒะฐะฝะธะตะผ `zap`
- **Metrics** - ะญะบัะฟะพัั ะผะตััะธะบ ะฒ ัะพัะผะฐัะต Prometheus
- **Swagger Documentation** - ะะฒัะพะผะฐัะธัะตัะบะธ ัะณะตะฝะตัะธัะพะฒะฐะฝะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั API
- **Testing** - Unit ะธ ะธะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั

## ๐ ะขะตัะฝะพะปะพะณะธะธ

- **Go 1.25**
- **Gin** (HTTP framework)
- **pgx/v5** (PostgreSQL driver)  
- **segmentio/kafka-go** (Kafka client)
- **zap** (Logger)
- **prometheus/client_golang** (Metrics)
- **testify** (Testing)
- **Docker & Docker Compose**
- **PostgreSQL 17**
- **Kafka** (Confluent Platform 7.9.2)

## ๐ ะัััััะน ััะฐัั

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั

- Docker & Docker Compose
- Go 1.25+ (ะดะปั ะปะพะบะฐะปัะฝะพะน ัะฐะทัะฐะฑะพัะบะธ)
- Make (ะพะฟัะธะพะฝะฐะปัะฝะพ)

### ะะฐะฟััะบ ะฟัะพะตะบัะฐ

1. **ะะปะพะฝะธัะพะฒะฐะฝะธะต ัะตะฟะพะทะธัะพัะธั**
```bash
git clone <repository-url>
cd order-service
```

2. **ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ**
```bash
make compose-up-all
# ะะปะธ ะฝะฐะฟััะผัั ัะตัะตะท docker-compose
# docker-compose up --build -d
```

3. **ะัะพะฒะตัะบะฐ ัะฐะฑะพัะพัะฟะพัะพะฑะฝะพััะธ**
```bash
# Health check
curl http://localhost:8080/health

# ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ
curl http://localhost:8080/orders/{order_uid}
```

### ะัะฟะพะปัะทะพะฒะฐะฝะธะต

1. ะัะบัะพะนัะต ะฒะตะฑ-ะธะฝัะตััะตะนั: `http://localhost:8080`
2. ะัะฟัะฐะฒััะต ัะตััะพะฒะพะต ัะพะพะฑัะตะฝะธะต ะฒ Kafka:
```bash
# ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ (ััะตะฑัะตั .env)
make run-producer

# ะะฐะฟััะบ ัะตัะตะท docker compose
docker run kafka-producer
```
3. ะะฒะตะดะธัะต UID ะทะฐะบะฐะทะฐ ะฒ ะฟะพะปะต ะฟะพะธัะบะฐ ะฒะตะฑ-ะธะฝัะตััะตะนัะฐ
4. ะัะพะฒะตัััะต API ะฝะฐะฟััะผัั:
```bash
curl http://localhost:8080/orders/b563feb7b2b84b6test
```

## ๐ ะะพะฝะธัะพัะธะฝะณ ะธ ะดะพะบัะผะตะฝัะฐัะธั

- **API**: http://localhost:8080
- **Swagger UI**: http://localhost:8080/swagger/index.html
- **Prometheus**: http://localhost:9090
- **Grafana**: http://localhost:3000 (admin/grafana)
- **ะะตััะธะบะธ ะฟัะธะปะพะถะตะฝะธั**: http://localhost:8081/metrics

## ๐ง ะะพะฝัะธะณััะฐัะธั

### ะะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั

ะะพะปะฝัะน ะฟัะธะผะตั ะบะพะฝัะธะณััะฐัะธะธ ัะผ. ะฒ `.env.example`

## ๐๏ธ ะกัััะบัััะฐ ะฟัะพะตะบัะฐ

```
โโโ cmd/                    # ะขะพัะบะธ ะฒัะพะดะฐ
โ   โโโ order-service/      # ะัะฝะพะฒะฝะพะน ัะตัะฒะธั
โ   โโโ producer-service/   # ะญะผัะปััะพั Kafka producer
โโโ configs/               # ะะพะฝัะธะณััะฐัะธะธ
โโโ docs/                  # Swagger ะดะพะบัะผะตะฝัะฐัะธั (ะฐะฒัะพะณะตะฝะตัะธััะตััั)
โโโ internal/              # ะะฝัััะตะฝะฝัั ะปะพะณะธะบะฐ
โ   โโโ app/              # ะะฝะธัะธะฐะปะธะทะฐัะธั ะฟัะธะปะพะถะตะฝะธั
โ   โโโ config/           # ะะพะฝัะธะณััะฐัะธั
โ   โโโ entity/           # ะะธะทะฝะตั-ัััะฝะพััะธ
โ   โโโ repository/       # ะกะปะพะน ะดะฐะฝะฝัั
โ   โโโ service/          # ะะธะทะฝะตั-ะปะพะณะธะบะฐ
โ   โโโ transport/        # HTTP/Kafka ััะฐะฝัะฟะพััั
โ       โโโ http/         # HTTP handlers, middleware
โ       โโโ kafka/        # Kafka consumer, DLQ
โโโ migrations/           # ะะธะณัะฐัะธะธ ะะ
โโโ pkg/                  # ะะตัะตะธัะฟะพะปัะทัะตะผัะต ะฟะฐะบะตัั
โ   โโโ cache/           # LRU ะบัั
โ   โโโ kafka/           # Kafka utilities
โ   โโโ logger/          # ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต
โ   โโโ metric/          # Prometheus ะผะตััะธะบะธ
โ   โโโ storage/         # PostgreSQL ะบะปะธะตะฝั
โ       โโโ transaction/ # ะะตะฝะตะดะถะตั ัะฐะฑะพัั ั ััะฐะฝะทะฐะบัะธัะผะธ
โโโ tests/               # ะขะตััั
โ   โโโ integration/     # ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
โโโ web/                # ะะตะฑ-ะธะฝัะตััะตะนั
โโโ volumes/            # Docker volumes
```

## ๐งช ะะฐะทัะฐะฑะพัะบะฐ ะธ ัะตััะธัะพะฒะฐะฝะธะต

### ะะพะบะฐะปัะฝัะน ะทะฐะฟััะบ

```bash
# ะะฐะฟััะบ ะทะฐะฒะธัะธะผะพััะตะน
docker-compose --env-file .env up -d db kafka zookeeper

# ะัะธะผะตะฝะตะฝะธะต ะผะธะณัะฐัะธะน
make migrate-up

# ะะฐะฟััะบ ัะตัะฒะธัะฐ (ััะตะฑัะตั .env)
make run
```

### ะขะตััะธัะพะฒะฐะฝะธะต

```bash
# Unit ัะตััั
make test

# ะะฝัะตะณัะฐัะธะพะฝะฝัะต ัะตััั
make compose-up-integration-test

# ะะธะฝัะธะฝะณ | Golangci linter
make linter-golangci

# ะะธะฝัะธะฝะณ | Hadolint
make linter-hadolint

# ะะธะฝัะธะฝะณ | DotEnv linter
make linter-dotenv

# ะัะพะฒะตัะบะฐ ะทะฐะฒะธัะธะผะพััะตะน
make deps-audit
```

### Swagger ะดะพะบัะผะตะฝัะฐัะธั

ะะตะฝะตัะฐัะธั ะดะพะบัะผะตะฝัะฐัะธะธ:
```bash
make swag-v1
```

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั ะธ ะผะตััะธะบะธ

### ะะฟัะธะผะธะทะฐัะธะธ

1. **ะััะธัะพะฒะฐะฝะธะต**: LRU ะบัั ั TTL ะดะปั ะฑััััะพะณะพ ะดะพัััะฟะฐ ะบ ะทะฐะบะฐะทะฐะผ
2. **Connection Pooling**: ะะฟัะธะผะธะทะธัะพะฒะฐะฝะฝัะน ะฟัะป ัะพะตะดะธะฝะตะฝะธะน ั ะะ
3. **Batch Processing**: ะะฐะบะตัะฝะฐั ะพะฑัะฐะฑะพัะบะฐ ัะพะพะฑัะตะฝะธะน Kafka
4. **Graceful Shutdown**: ะะพััะตะบัะฝะพะต ะทะฐะฒะตััะตะฝะธะต ั ัะพััะฐะฝะตะฝะธะตะผ ะดะฐะฝะฝัั

### ะะพัััะฟะฝัะต ะผะตััะธะบะธ

- HTTP ะทะฐะฟัะพัั/ะพัะฒะตัั (ะบะพะปะธัะตััะฒะพ, ะดะปะธัะตะปัะฝะพััั, ะผะตะดะปะตะฝะฝัะต ะทะฐะฟัะพัั)
- Kafka ัะพะพะฑัะตะฝะธั (ะพะฑัะฐะฑะพัะฐะฝะฝัะต, ะพัะธะฑะบะธ, lag)
- ะัั (hit/miss, eviction, ัะฐะทะผะตั)  
- ะขัะฐะฝะทะฐะบัะธะธ ะะ (ััะฟะตัะธ, ะพัะธะฑะบะธ, retry)

## ๐ API ะะพะบัะผะตะฝัะฐัะธั

### GET /health
Health check endpoint

**Response:**
```json
{
  "status": "ok"
}
```

### GET /orders/{order_uid}
ะะพะปััะตะฝะธะต ะทะฐะบะฐะทะฐ ะฟะพ ID

**Response:**
```json
{
  "order_uid": "550e8400-e29b-41d4-a716-446655440000",
  "track_number": "WBILMTESTTRACK",
  "entry": "WBIL",
  "delivery": {
    "name": "Test Testov",
    "phone": "+9720000000",
    "zip": "2639809",
    "city": "Kiryat Mozkin",
    "address": "Ploshad Mira 15",
    "region": "Kraiot",
    "email": "test@gmail.com"
  },
  "payment": {
    "transaction": "b563feb7b2b84b6test",
    "currency": "USD",
    "provider": "wbpay",
    "amount": 1817,
    "payment_dt": 1637907727,
    "bank": "alpha",
    "delivery_cost": 1500,
    "goods_total": 317
  },
  "items": [
    {
      "chrt_id": 9934930,
      "track_number": "WBILMTESTTRACK",
      "price": 453,
      "name": "Mascaras",
      "sale": 30,
      "size": "0",
      "total_price": 317,
      "nm_id": 2389212,
      "brand": "Vivienne Sabo",
      "status": 202
    }
  ],
  "locale": "en",
  "customer_id": "test",
  "delivery_service": "meest",
  "date_created": "2021-11-26T06:22:19Z"
}
```

ะะพะปะฝะฐั ะดะพะบัะผะตะฝัะฐัะธั API ะดะพัััะฟะฝะฐ ะฒ Swagger UI: http://localhost:8080/swagger/index.html

## ๐ ะะฐะทะฒะตัััะฒะฐะฝะธะต

### Docker
```bash
docker build -t order-service .
docker run -p 8080:8080 order-service
```

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะะฐะปะธะดะฐัะธั ะฒัะตั ะฒัะพะดะฝัั ะดะฐะฝะฝัั
- ะกัััะบัััะธัะพะฒะฐะฝะฝะพะต ะปะพะณะธัะพะฒะฐะฝะธะต ะฒัะตั ะพะฟะตัะฐัะธะน
- Graceful error handling
- ะะตะทะพะฟะฐัะฝะฐั ะบะพะฝัะธะณััะฐัะธั ะฟะพะดะบะปััะตะฝะธะน

## ๐ ะะธัะตะฝะทะธั

MIT 0 License - ัะผ. ัะฐะนะป [LICENSE](LICENSE) ะดะปั ะดะตัะฐะปะตะน.
